# QwertyTown Business Module

Модуль управления бизнесом для платформы QwertyTown - система управления бронированиями, услугами и клиентами для предприятий сферы услуг.

## Функциональные возможности

### Для бизнеса:
- Управление услугами (добавление, редактирование, удаление)
- Настройка доступности услуг по датам и времени
- Управление расписанием работы
- Просмотр и управление бронированиями
- Аналитика и отчёты по продажам, популярным услугам и клиентам
- Интеграция с календарем и отправка уведомлений

### Для клиентов:
- Поиск компаний и услуг
- Просмотр доступности услуг
- Бронирование услуг
- Управление своими бронированиями (просмотр, отмена)
- Просмотр истории бронирований

## Технический стек

- **Бэкенд**: FastAPI, SQLAlchemy, Pydantic
- **База данных**: PostgreSQL
- **Аутентификация**: JWT
- **Хранение файлов**: Amazon S3 или совместимые альтернативы
- **Документация API**: Swagger/OpenAPI

## Установка и запуск

### Зависимости

- Python 3.10+
- PostgreSQL 14+
- Виртуальное окружение (опционально, но рекомендуется)

### Шаги установки

1. Клонировать репозиторий:
```bash
git clone https://github.com/yourusername/qwertytown-business.git
cd qwertytown-business
```

2. Создать и активировать виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate.bat  # для Windows
```

3. Установить зависимости:
```bash
pip install -r requirements.txt
```

4. Создать файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

5. Настроить переменные окружения в `.env` файле.

6. Выполнить миграции базы данных:
```bash
alembic upgrade head
```

7. Запустить приложение:
```bash
python main.py
```

После запуска API будет доступен по адресу `http://localhost:8080`

## Структура проекта

```
src/
├── api/                # Ручки API
│   ├── auth.py         # Аутентификация и авторизация
│   ├── booking.py      # Управление бронированиями
│   ├── company.py      # Управление компаниями
│   ├── services.py     # Управление услугами
│   └── analytics.py    # Аналитика и отчёты
├── core/               # Ядро приложения
│   ├── config.py       # Конфигурация
│   ├── security.py     # Безопасность и JWT
│   └── errors.py       # Обработка ошибок
├── db/                 # Работа с базой данных
│   ├── database.py     # Настройки подключения
│   └── migrations/     # Миграции Alembic
├── models/             # Модели данных SQLAlchemy
├── repositories/       # Репозитории для работы с данными
├── schemas/            # Pydantic-схемы для валидации
├── services/           # Бизнес-логика
└── utils/              # Вспомогательные утилиты
```

## API-документация

После запуска приложения документация API доступна по адресу:
- Swagger UI: `http://localhost:8080/docs`
- ReDoc: `http://localhost:8080/redoc`

## Разработка

### Добавление новых миграций

```bash
alembic revision --autogenerate -m "Description of change"
alembic upgrade head
```

### Запуск тестов

```bash
pytest
```

## Лицензия

MIT 

## Сервис бронирования услуг

### Общее описание
Сервис бронирования услуг предоставляет функциональность для компаний и их клиентов. 
Компании могут размещать информацию о себе и предлагаемых услугах, а клиенты могут осуществлять бронирование этих услуг.

### Основные компоненты

#### API сервиса
- **API для аутентификации**: регистрация, авторизация, управление токенами
- **API для управления компаниями**: создание, редактирование, просмотр
- **API для управления услугами**: создание, редактирование, просмотр
- **API для управления бронированиями**: создание, отмена, подтверждение
- **API для аналитики**: получение статистики по бронированиям
- **API для модерации**: управление процессом модерации компаний
- **API для работы с Telegram**: отправка уведомлений и обработка сообщений

#### Веб-интерфейс бизнес-модуля
Бизнес-модуль представляет собой веб-интерфейс для компаний, позволяющий управлять информацией о компании, услугах и бронированиях, а также просматривать аналитику.

Основные страницы:
- **Главная страница**: список компаний пользователя, возможность создания новой компании
- **Панель управления компанией**: общая информация и статистика по компании
- **Управление услугами**: добавление, редактирование и удаление услуг компании
- **Управление бронированиями**: просмотр и управление бронированиями
- **Аналитика**: графики и статистика по работе компании
- **Настройки компании**: управление информацией о компании, адресах и часах работы

### Технологии

#### Backend
- FastAPI: веб-фреймворк для создания API с поддержкой асинхронных запросов
- SQLAlchemy 2.0: ORM для работы с базой данных
- Pydantic 2.0: валидация данных и создание схем
- PostgreSQL: база данных
- asyncpg: асинхронный драйвер для работы с PostgreSQL
- Alembic: инструмент для миграций базы данных
- Python-jose, passlib, bcrypt: инструменты для работы с JWT-токенами и паролями

#### Frontend
- Jinja2: шаблонизатор для генерации HTML
- Bootstrap 5: CSS-фреймворк для адаптивного дизайна
- Chart.js: библиотека для визуализации данных
- Font Awesome: иконки

### Установка и запуск

1. Клонировать репозиторий:
```bash
git clone <repository-url>
cd Hakaton_06_04_2005
```

2. Создать виртуальное окружение и установить зависимости:
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

3. Создать .env файл на основе .env.example и настроить параметры:
```bash
cp .env.example .env
# Отредактировать .env файл
```

4. Запустить миграции для создания структуры базы данных:
```bash
alembic upgrade head
```

5. Запустить приложение:
```bash
python main.py
```

### Структура проекта

```
Hakaton_06_04_2005/
├── alembic/              # Миграции базы данных
├── main.py               # Точка входа приложения
├── requirements.txt      # Зависимости проекта
├── .env.example          # Пример файла окружения
├── src/                  # Исходный код приложения
│   ├── api/              # API эндпоинты
│   ├── core/             # Основные компоненты (конфиг, ошибки, JWT)
│   ├── db/               # Настройки базы данных
│   ├── models/           # SQLAlchemy модели
│   ├── repositories/     # Репозитории для работы с данными
│   ├── schemas/          # Pydantic схемы
│   ├── services/         # Бизнес-логика и внешние интеграции
│   ├── static/           # Статические файлы (CSS, JS, изображения)
│   ├── templates/        # Jinja2 шаблоны
│   └── app.py            # Основное приложение FastAPI
```

### API Документация

После запуска приложения, документация API доступна по адресам:
- Swagger UI: http://localhost:8080/docs
- ReDoc: http://localhost:8080/redoc

### Бизнес-модуль

Бизнес-модуль доступен по адресу: http://localhost:8080/business 

## Запуск с использованием Docker

Проект полностью настроен для запуска в Docker. Следуйте этим шагам:

1. Убедитесь, что у вас установлены Docker и Docker Compose
2. Клонируйте репозиторий и перейдите в его директорию
3. Запустите приложение:

```bash
docker compose up -d
```

4. Для применения миграций:

```bash
docker compose exec app alembic upgrade head
```

5. Приложение будет доступно по адресу http://localhost:8080

### Завершение работы

```bash
docker compose down
```

Для полного удаления данных (включая данные базы данных):

```bash
docker compose down -v
```
